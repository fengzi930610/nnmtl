<{include file="block/header.html"}><style type="text/css">.divideGroups{overflow: hidden;}.divideGroups .add_btn{display: inline-block;margin-right: 20px;margin-bottom: 20px;color: #555;font-size: 12px;line-height: 28px;height: 30px;width: 80px;text-align: center;border: 1px dashed #bbb;cursor: pointer;}.divideGroups .list_box label{position: relative;display: inline-block;height: 30px;padding: 0 16px;color: #555;font-size: 12px;line-height: 28px;border: 1px solid #bbb;border-radius: 2px;cursor: pointer; margin-right: 10px;}.divideGroups .list_box label input{width: 0; height: 0;opacity: 0;}.divideGroups .list_box label.on{border-color: #00bd9e;}.divideGroups .list_box label.on:before{content: " ";position: absolute;right: 0;bottom: 0;width: 0;height: 0;border: 7px solid #00bd9e;border-top-color: transparent;border-left-color: transparent;}.divideGroups .list_box label.on:after {content: " ";position: absolute;right: 1px;bottom: 3px;width: 6px;height: 3px;border: 1px solid #fff;border-top-color: transparent;border-right-color: transparent; -webkit-transform: rotate(-59deg);transform: rotate(-59deg);}.divideGroups_mask .cont{padding: 30px 20px 10px;}.divideGroups_mask .cont .int{width: 100%; height: 34px; border: 1px solid #e6e6e6; background: none; border-radius: 3px; padding-left: 10px; outline: 0; font-size: 14px;}</style><script type="text/javascript" src="%THEME%/static/js/common.js"></script><div class="breadcrumb_box">    <ol class="breadcrumb">        <li><a href="<{link ctl='index:home'}>"><i class="glyphicon glyphicon-home mr10"></i>首页</a></li>        <li><a href="<{link ctl='product/product/index'}>">商品管理</a></li>        <li class="active">添加商品</li>    </ol></div><script>    function fileSelected(obj, type) {        var files = obj.files;        for (var i = 0; i < files.length; i++) {            var tag = '';            var rFilter = /^(image\/gif|image\/jpeg|image\/jpg|image\/png)$/i;            if (!rFilter.test(files[i].type)) {                alert("只允许上传JPG、PNG、GIF格式图片");                return false;            }            var reader = new FileReader();            reader.onloadstart = function (e) {                $(".loading").show();            }            reader.onload = function (e) {                $("#img_" + type).attr("src", e.target.result).show();  //图片编码字符串                $(".img_" + type).attr("rel", e.target.result);  //图片编码字符串            }            reader.readAsDataURL(files[i]);        }    }</script><div class="wrapper-content_box">    <div class="wrapper wrapper-content">        <!--表单-->        <div class="tabnr_change show">            <form action="<{link ctl='product/product/create'}>" mini-form="wmbiz" method="post" target="miniframe">            <table class="form_table" width="100%" border="0" cellspacing="0" cellpadding="0">                <!-- <tr>                    <td><p class="form_table_t"><em>·</em>商品分类：</p></td>                    <td>                        <div class="form_table_nr">                            <select id="select_1" name="data[cate_id][1]" class="form_table_int form_table_intw2 fl">                                <option value="0">请选择</option>                                <{foreach $pcates as $item}>                                <option value="<{$item.cate_id}>"><{$item.title}></option>                                <{/foreach}>                            </select>                            <select id="select_2" name="data[cate_id][2]" class="form_table_int form_table_intw2 fl ml10">                                <option value="0">请选择</option>                            </select>                            <a href="<{link ctl='product/cate/create'}>" class="btn btn-primary btn-sm fl ml20">添加分类</a>                        </div>                    </td>                </tr> -->                <tr>                    <td><p class="form_table_t">分类：</p></td>                    <td>                        <div class="form_table_nr">                            <div class="divideGroups">                                <a href="<{link ctl='product/cate/create'}>" class="add_btn fl">+添加分类</a>                                <div class="list_box fl">                                    <{foreach $pcates as $cate}>                                        <label><input type="checkbox" name="data[cate_ids][]" value="<{$cate.cate_id}>"><{$cate.title}></label>  <{/foreach}>                                    <!-- <label><input type="checkbox" name="date[cate_ids][]">热菜</label>                                    <label><input type="checkbox" name="date[cate_ids][]">冷菜</label>                                    <label><input type="checkbox" name="date[cate_ids][]">饮料</label> -->                                </div>                            </div>                            <!--新建分组弹层-开始-->                            <div class="mask_cont divideGroups_mask">                                <div class="mask_cont_tit text_c">添加分类</div>                                <div class="cont">                                    <input type="text" class="int" placeholder="分类名称，最多10个字" maxlength="10" name="">                                    <div class="text_c mt20" style="padding-bottom: 10px;">                                        <a href="javascript:;" class="btn btn-w-m btn-default cancel">取消</a>                                        <a href="javascript:;" class="btn btn-w-m btn-primary comfirt">保存</a>                                    </div>                                </div>                            </div>                            <div class="mask_bg"></div>                            <!--<script>                                $(document).ready(function () {                                    var evlt_h = $('.divideGroups_mask').height();                                    var evlt_w = $('.divideGroups_mask').width();                                    $('.divideGroups_mask').css("margin-top", -evlt_h / 2 + 'px');                                    $('.divideGroups_mask').css("margin-left", -evlt_w / 2 + 'px');                                    $(".divideGroups .add_btn").click(function () {                                        $('.divideGroups_mask').fadeIn(100);                                        $('.mask_bg').fadeIn(100);                                    });                                    $(".divideGroups_mask .cancel,.mask_bg").click(function () {                                        $('.divideGroups_mask').fadeOut(100);                                        $('.mask_bg').fadeOut(100);                                    });                                });                            </script>-->                            <!--新建分组弹层-结束-->                        </div>                    </td>                </tr>                <{*                <tr>                    <td><p class="form_table_t"><em>·</em>系统分类：</p></td>                    <td>                        <div class="form_table_nr">                            <select id="select-1" name="data[cat_id][1]" class="form_table_int form_table_intw2 fl">                                <option value="0">请选择</option>                                <{foreach $xcates as $item}>                                <option value="<{$item.cate_id}>"><{$item.title}></option>                                <{/foreach}>                            </select>                            <select id="select-2" name="data[cat_id][2]" class="form_table_int form_table_intw2 fl ml10">                                <option value="0">请选择</option>                            </select>                            <select id="select-3" name="data[cat_id][3]" class="form_table_int form_table_intw2 fl ml10">                                <option value="0">请选择</option>                            </select>                        </div>                    </td>                </tr>                *}>                <tr>                    <td width="120"><p class="form_table_t"><em>·</em>商品名称：</p></td>                    <td><div class="form_table_nr"><input type="text" name="data[title]" class="form_table_int form_table_intw1" /></div></td>                </tr>                <tr>                    <td width="120"><p class="form_table_t"><em>·</em>商品单位：</p></td>                    <td>                        <div class="form_table_nr">                            <select  name="data[unit]" class="form_table_int form_table_intw2 fl">                                <option value="">请选择</option>                                <{foreach $unit_list as $v}>                                <option value="<{$v}>"><{$v}></option>                                <{/foreach}>                            </select>                        </div>                    </td>                </tr>                <tr>                    <td><p class="form_table_t"><em>·</em>商品图片：</p></td>                    <td>                        <div class="form_table_nr">                            <div class="fl form_table_scimg">                                <a class="btn btn-primary btn-sm upload_img_btn">图片上传 <input type="file" name="data[photo][0]" id="photo_0" onchange="fileSelected(this,0)" class="scimg_int" /></a>                                <p>建议尺寸300*300</p></div>                            <div class="fl">                                <div class="form_table_sjimg"><img id="img_0" src="<{$pager.img}>/default/product.png" width="78" height="78" /></div>                            </div>                        </div>                    </td>                </tr>                <tr>                    <td><p class="form_table_t"><em>·</em>商品规格：</p></td>                    <td>                        <div class="spec_mask spec_mask1">                            <div class="cont" style="width:920px;">                                <div class="table_box">                                    <table border="0" cellspacing="0" cellpadding="0">                                        <tr class="tit">                                            <td><span class="pointcl">*</span>价格</td>                                            <td><span class="pointcl">*</span>打包费</td>                                            <td class="sku_num"><span class="pointcl">*</span>库存(份)</td>                                            <td class="cz">&nbsp;</td>                                        </tr>                                        <tr class="tit_spec none">                                            <td><span class="pointcl">*</span>规格</td>                                            <td><span class="pointcl">*</span>价格</td>                                            <td><span class="pointcl">*</span>打包费</td>                                            <td class="sku_num"><span class="pointcl">*</span>库存(份)</td>                                            <!-- <td style="width: 180px;"><span class="pointcl">*</span>图片</td> -->                                            <td class="cz" style="width: 250px;">&nbsp;</td>                                        </tr>                                        <tr class="int_box" id="first_box">                                            <td><input type="text" name="data[price]" class="int"></td>                                            <td><input type="text" name="data[package_price]" class="int"></td>                                            <!-- <td><input type="text" name="data[sale_sku]" class="int"></td> -->                                                                                        <td style="text-align: left;padding-left: 10px;width: 350px;height:32px;line-height:32px"><div class="pub_radio"><input type="radio" name="skutype" value="-1" class="check_box skutype fl" checked><span class="fl">不限库存</span><input type="radio" name="skutype" value="999" class="check_box skutype fl"><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="hidden" name="data[sale_sku]" class="int fl" value="-1"></div></td>                                            <td class="cz"><span class="black9"></span></td>                                        </tr>                                    </table>                                    <a href="javascript:;" class="btn btn-primary btn-sm btn-outline add_btn">添加规格</a>                                </div>                            </div>                        </div>                    </td>                </tr>                <tr>                    <td><p class="form_table_t"><em>·</em>商品属性：</p></td>                    <td>                        <div class="goodsCate">                            <input type="hidden" id="attr_name" name="data[attr_name]" value="">                            <input type="hidden" id="attr_val" name="data[attr_val]" value="">                            <div id="list_box_attr">                            </div>                            <a href="javascript:;" class="sku-add" title="添加规格">+</a>                        </div>                    </td>                </tr>                <tr>                    <td><p class="form_table_t">售卖状态：</p></td>                    <td>                        <div class="form_table_nr">                            <label class="mr30"><input type="radio" name="data[is_onsale]" checked="checked" value="1" class="check_box" />上架</label>                            <label class="mr30"><input type="radio" name="data[is_onsale]" value="0" class="check_box" />下架</label>                        </div>                    </td>                </tr>                <tr>                    <td width="120"><p class="form_table_t">商品排序：</p></td>                    <td><div class="form_table_nr"><input type="text" name="data[orderby]" value="50" class="form_table_int form_table_intw1" /></div></td>                </tr>                <tr>                    <td><p class="form_table_t">商品简介：</p></td>                    <td><div class="form_table_nr"><textarea name="data[intro]" class="form_table_int form_table_textarea"></textarea></div></td>                </tr>            </table>            <div class="form_table_btn_box text_c">                <input type="hidden" id="type" name="type" value=""/>                <input class="btn btn-primary btn-w-m sub_btn" rel="1" type="button" value="保存并返回" />                <input class="btn btn-primary btn-outline btn-w-m sub_btn" rel="2" type="button" value="保存并继续新建" />                <a class="btn btn-default btn-w-m" href="<{link ctl='product/product/index'}>">取消</a>            </div>        </form>        </div>        <!--表单end-->    </div>    <div id="preview" class="none"><img class="jq_preview" src="" width="200" height="200"/></div>    <!--规格编辑-->    <script>        $(document).ready(function () {            var j = 1;            var i = 1;            $(".spec_mask1 .add_btn").click(function () {                var price = '';                var package_price = '';                var sale_sku = -1;                if(j==1){                    price = $('#first_box input[name="data[price]"]').val();                    package_price = $('#first_box input[name="data[package_price]"]').val();                    sale_sku = $('#first_box input[name="data[sale_sku]"]').val();                    $(".tit").hide();                    $(".tit_spec").show();                    $("#first_box").remove();                }                var html = '<tr class="int_box">';                html += '<td><input type="text" name="datas['+i+'][spec_name]" class="int" value=""></td>';                html += '<td><input type="text" name="datas['+i+'][price]" class="int" value="'+price+'"></td>';                html += '<td><input type="text" name="datas['+i+'][package_price]" class="int" value="'+package_price+'"></td>';                if(sale_sku == -1){                    html += '<td style="text-align: left;width: 350px;height:32px;line-height:32px"><div class="pub_radio" style="padding-left: 10px;width:350px;"><input type="radio" name="skutype['+i+']" value="-1" class="check_box skutype fl" checked><span class="fl">不限库存</span><input type="radio" name="skutype['+i+']" value="999" class="check_box skutype fl"><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="hidden" name="datas['+i+'][sale_sku]" class="int fl" value="-1"></div></td>';                }else{                    sale_sku = parseInt(sale_sku);                    html += '<td style="text-align: left;width: 350px;height:32px;line-height:32px"><div class="pub_radio" style="padding-left: 10px;width:350px;"><input type="radio" name="skutype['+i+']" value="-1" class="check_box skutype fl"><span class="fl">不限库存</span><input type="radio" name="skutype['+i+']" value="'+sale_sku+'" class="check_box skutype fl" checked><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="text" name="datas['+i+'][sale_sku]" class="int fl" value="'+sale_sku+'"></div></td>';                }                                //html += '<td><a class="btn btn-primary btn-sm upload_img_btn">图片上传 <input type="file" name="data[photo]['+i+']" id="photo_'+i+'" onchange="fileSelected(this,'+i+')" class="scimg_int" /></a><span class="preview img_'+i+'" rel="">预览</span></td>';                html += '<td class="cz"><a href="javascript:;" class="fa fa-times-circle clear_btn ml20"></a></td>';                html += '</tr>';                $(this).parents(".spec_mask1").find(".table_box table").append(html);                i++;                j++;                /*$(".spec_mask1 .cont table tr td .clear_btn").click(function () {                    $(this).parents("tr.int_box").remove();                });*/            });            $(document).on('change','.skutype',function(){                var val = $(this).val();                if(val > 0){                   $(this).siblings('.int').attr('type','text').val(val);                 }else{                    $(this).siblings('.int').attr('type','hidden').val(val);                }            });            $(document).on("click",".spec_mask1 .cont table tr td .clear_btn",function(){                j--;                $(this).parents("tr.int_box").remove();                if(j==1){                    $(".tit").show();                    $(".tit_spec").hide();                    $(".spec_mask1 .cont table").append('<tr class="int_box" id="first_box"><td><input type="text" name="data[price]" class="int"></td><td><input type="text" name="data[package_price]" class="int"></td><td style="text-align: left;padding-left: 10px;width: 350px;height:32px;line-height:32px"><div class="pub_radio"><input type="radio" name="skutype" value="-1" class="check_box skutype fl" checked><span class="fl">不限库存</span><input type="radio" name="skutype" value="999" class="check_box skutype fl"><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="hidden" name="data[sale_sku]" class="int fl" value="-1"></div></td><td class="cz"><span class="black9"></span></td></tr>');                }            });            $(document).on("click",".preview",function(){                var pre = '<{$pager.img}>';                if($(this).attr("rel") == ""||$(this).attr("rel")==0||$(this).attr("rel")==pre){                    layer.msg("没有上传图片");                }else{                    $(".jq_preview").attr("src",$(this).attr("rel"));                    layer.open({                        type: 1,                        title: false,                        closeBtn: 1,                        area: '200px',                        skin: 'layui-layer-nobg', //没有背景色                        shadeClose: true,                        content: $('#preview')                    });                }            })            $(".sub_btn").click(function(){                $("#type").val($(this).attr('rel'));                $("form").submit();            })        });        var json_cates = <{$json_scates}>;        select(json_cates,2);        var json_xcates = <{$json_xcates}>;        select2(json_xcates,3);    </script>    <!--规格编辑end-->    window.__index = 0;    <script>        $('.sku-add').on('click',function(){            add_sku();        })       function add_sku(){           var j = $(".normslist:last").attr("rel");           if(j==undefined){               j = 1;           }else{               j = parseInt(j)+1;           }           var html = '<div class="cate_list normslist " rel="'+j+'">'+                   '<div class="cate_one">'+                   '<input type="text" rel="'+j+'" name="data[key]['+j+']" class="jq_attr_name  " id="attr_key'+j+'"  placeholder="属性名称">'+                   '<a href="javascript:;" rel="" class="clear_btn fr j-delNorms reformat_remove_ye " rel="'+j+'"><i class="fa fa-trash"></i>移除</a>'+                   '</div>'+                   '<div class="cate_two">'+                   '<div class="skuitemPanel">'+                   '<ul class="labelList" id="labelList_'+j+'">'+                   '</ul>'+                   '<div class="add_box">'+                   '<input type="text" class="input" value="" id="attr_tmp_'+j+'">'+                   '</div>'+                   '<a href="javascript:;" class="btn btn-primary btn-sm attr_val_add" rel="'+j+'">添加</a>'+                   '</div>'+                   '</div>'+                   '</div>';           $('#list_box_attr').append(html);           remove_sku();           attr_add();       }       function remove_sku(){           $('.reformat_remove_ye').off().on('click',function(){               $(this).parent().parent().remove();           })       }       function remove_attr(){           $('.gicon-remove').off().on('click',function(){               $(this).parent().parent().remove();           })       }       function attr_add(){           $('.attr_val_add').off().on('click',function(){               var index_key = $(this).attr('rel');               var val = $('#attr_key'+index_key).val();               if(!val){                   layer.msg('请填写属性名称');                   return false;               }               var attr_val = $('#attr_tmp_'+index_key).val();               if(!attr_val){                   layer.msg('请填写属性值');                   return false;               }               var html = '<li rel="'+index_key+'" class="attr_val" data="'+attr_val+'" ><input type="hidden" name="data[val]['+index_key+'][]" value="'+attr_val+'"/><div class="box"><span><i>'+attr_val+'</i></span><i class="fa fa-close gicon-remove" rel=""></i></div></li>';               $('#labelList_'+index_key).append(html);               $('#attr_tmp_'+index_key).val("");               remove_attr();           })       }    </script>    <script type="text/javascript">        //分组新增和选中js        $(".divideGroups .list_box label input").click(function(){            if($(this).prop('checked')){//获取是否选中 并判断                $(this).parent().addClass("on"); //修改设置为不选中状态            }else{                $(this).parent().removeClass("on");//修改设置为选中状态            }        });        $(".divideGroups .add_btn").click(function(){        });    </script>    <{include file="block/footer.html"}>