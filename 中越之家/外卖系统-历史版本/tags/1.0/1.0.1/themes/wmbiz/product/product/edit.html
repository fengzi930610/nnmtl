 <{include file="block/header.html"}> <style type="text/css">.divideGroups{overflow: hidden;}.divideGroups .add_btn{display: inline-block;margin-right: 20px;margin-bottom: 20px;color: #555;font-size: 12px;line-height: 28px;height: 30px;width: 80px;text-align: center;border: 1px dashed #bbb;cursor: pointer;}.divideGroups .list_box label{position: relative;display: inline-block;height: 30px;padding: 0 16px;color: #555;font-size: 12px;line-height: 28px;border: 1px solid #bbb;border-radius: 2px;cursor: pointer; margin-right: 10px;}.divideGroups .list_box label input{width: 0; height: 0;}.divideGroups .list_box label.on{border-color: #00bd9e;}.divideGroups .list_box label.on:before{content: " ";position: absolute;right: 0;bottom: 0;width: 0;height: 0;border: 7px solid #00bd9e;border-top-color: transparent;border-left-color: transparent;}.divideGroups .list_box label.on:after {content: " ";position: absolute;right: 1px;bottom: 3px;width: 6px;height: 3px;border: 1px solid #fff;border-top-color: transparent;border-right-color: transparent; -webkit-transform: rotate(-59deg);transform: rotate(-59deg);}.divideGroups_mask .cont{padding: 30px 20px 10px;}.divideGroups_mask .cont .int{width: 100%; height: 34px; border: 1px solid #e6e6e6; background: none; border-radius: 3px; padding-left: 10px; outline: 0; font-size: 14px;}</style><script type="text/javascript" src="%THEME%/static/js/common.js"></script><div class="breadcrumb_box">    <ol class="breadcrumb">        <li><a href="<{link ctl='index:home'}>"><i class="glyphicon glyphicon-home mr10"></i>首页</a></li>        <li><a href="<{link ctl='product/product/index'}>">商品管理</a></li>        <li class="active">编辑商品</li>    </ol></div><script>    function fileSelected(obj, type) {        var files = obj.files;        for (var i = 0; i < files.length; i++) {            var tag = '';            var rFilter = /^(image\/gif|image\/jpeg|image\/jpg|image\/png)$/i;            if (!rFilter.test(files[i].type)) {                alert("只允许上传JPG、PNG、GIF格式图片");                return false;            }            var reader = new FileReader();            reader.onloadstart = function (e) {                $(".loading").show();            }            reader.onload = function (e) {                $("#img_" + type).attr("src", e.target.result).show();  //图片编码字符串                $(".img_" + type).attr("rel", e.target.result);  //图片编码字符串            }            reader.readAsDataURL(files[i]);        }    }</script><div class="wrapper-content_box">    <div class="wrapper wrapper-content">        <!--表单-->        <div class="tabnr_change show">            <form action="<{link ctl='product/product/edit' arg0=$detail.product_id}>" mini-form="wmbiz" method="post" target="miniframe">            <table class="form_table" width="100%" border="0" cellspacing="0" cellpadding="0">                <!-- <tr>                    <td><p class="form_table_t"><em>·</em>商品分类：</p></td>                    <td>                        <div class="form_table_nr">                            <select id="select_1" name="data[cate_id][1]" class="form_table_int form_table_intw2 fl">                                <option value="0">请选择</option>                                <{foreach $pcates as $item}>                                <option <{if $item.cate_id == $cate_id}>selected="selected"<{/if}> value="<{$item.cate_id}>"><{$item.title}></option>                                <{/foreach}>                            </select>                            <select id="select_2" name="data[cate_id][2]" class="form_table_int form_table_intw2 fl ml10">                                <option value="0">请选择</option>                            </select>                            <a href="<{link ctl='product/cate/create'}>" class="btn btn-primary btn-sm fl ml20">添加分类</a>                        </div>                    </td>                </tr> -->                <tr>                    <td><p class="form_table_t">分类：</p></td>                    <td>                        <div class="form_table_nr">                            <div class="divideGroups">                                <a href="<{link ctl='product/cate/create'}>" class="add_btn fl">+添加分类</a>                                <div class="list_box fl">                                    <{foreach $pcates as $cate}>                                        <label <{if in_array($cate.cate_id,$detail.cate_ids)}>class="on"<{/if}>><input type="checkbox" name="data[cate_ids][]" value="<{$cate.cate_id}>" <{if in_array($cate.cate_id,$detail.cate_ids)}>checked<{/if}>><{$cate.title}></label>                                    <{/foreach}>                                </div>                            </div>                            <script type="text/javascript">                                //分组新增和选中js                                $(".divideGroups .list_box label input").click(function(){                                    if($(this).prop('checked')){//获取是否选中 并判断                                        $(this).parent().addClass("on"); //修改设置为不选中状态                                    }else{                                        $(this).parent().removeClass("on");//修改设置为选中状态                                    }                                });                                $(".divideGroups .add_btn").click(function(){                                });                            </script>                        </div>                    </td>                </tr>                <!-- 取消系统分类 -->                <{*                <tr>                    <td><p class="form_table_t"><em>·</em>系统分类：</p></td>                    <td>                        <div class="form_table_nr">                            <select id="select-1" name="data[cat_id][1]" class="form_table_int form_table_intw2 fl">                                <option value="0">请选择</option>                                <{foreach $xcates as $item}>                                <option <{if $item.cate_id == $cat_id}>selected="selected"<{/if}> value="<{$item.cate_id}>"><{$item.title}></option>                                <{/foreach}>                            </select>                            <select id="select-2" name="data[cat_id][2]" class="form_table_int form_table_intw2 fl ml10">                                <option value="0">请选择</option>                            </select>                            <select id="select-3" name="data[cat_id][3]" class="form_table_int form_table_intw2 fl ml10">                                <option value="0">请选择</option>                            </select>                        </div>                    </td>                </tr>                *}>                <!-- //取消系统分类 -->                <tr>                    <td width="120"><p class="form_table_t"><em>·</em>商品名称：</p></td>                    <td><div class="form_table_nr"><input type="text" name="data[title]" value="<{$detail.title}>" class="form_table_int form_table_intw1" /></div></td>                </tr>                <tr>                    <td width="120"><p class="form_table_t"><em>·</em>商品单位：</p></td>                    <td>                        <div class="form_table_nr">                            <select  name="data[unit]" class="form_table_int form_table_intw2 fl">                                <option value="">请选择</option>                                <{foreach $unit_list as $v}>                                <option value="<{$v}>" <{if $v==$detail.unit}>selected="selected"<{/if}>><{$v}></option>                                <{/foreach}>                            </select>                        </div>                    </td>                </tr>                <tr>                    <td><p class="form_table_t"><em>·</em>商品图片：</p></td>                    <td>                        <div class="form_table_nr">                            <div class="fl form_table_scimg">                                <a class="btn btn-primary btn-sm upload_img_btn">图片上传 <input type="file" name="data[photo][0]" id="photo_0" onchange="fileSelected(this,0)" class="scimg_int" /></a>                                <p>建议尺寸300*300</p></div>                            <div class="fl">                                <div class="form_table_sjimg"><img id="img_0" src="<{$pager.img}>/<{$detail.photo|default:'product.png'}>" width="78" height="78" /></div>                            </div>                        </div>                    </td>                </tr>                <tr>                    <td><p class="form_table_t"><em>·</em>商品规格：</p></td>                    <td>                        <div class="spec_mask spec_mask1">                            <div class="cont" style="width:920px;">                                <div class="table_box">                                    <table border="0" cellspacing="0" cellpadding="0">                                        <tr class="tit <{if $detail.is_spec == 1}>none<{/if}>"  >                                            <td><span class="pointcl">*</span>价格</td>                                            <td><span class="pointcl">*</span>打包费</td>                                            <td style="width:300px;"><span class="pointcl">*</span>库存(份)</td>                                            <td class="cz">&nbsp;</td>                                        </tr>                                        <tr class="tit_spec <{if $detail.is_spec == 0}>none<{/if}>">                                            <td><span class="pointcl">*</span>规格</td>                                            <td><span class="pointcl">*</span>价格</td>                                            <td><span class="pointcl">*</span>打包费</td>                                            <td style="width:300px;"><span class="pointcl">*</span>库存(份)</td>                                            <!-- <td style="width: 180px;"><span class="pointcl">*</span>图片</td> -->                                            <td class="cz" style="width: 250px;">&nbsp;</td>                                        </tr>                                        <{if $detail.is_spec == 0}>                                        <tr class="int_box" id="first_box">                                            <td><input type="text" name="data[price]" value="<{$detail.price}>" class="int"></td>                                            <td><input type="text" name="data[package_price]" value="<{$detail.package_price}>" class="int"></td>                                            <!-- <td><input type="text" name="data[sale_sku]" value="<{$detail.sale_sku}>" class="int"></td> -->                                            <td style="text-align: left;width: 350px;height:32px;line-height:32px">                                                <{if $detail.sale_type == 0}>                                                                                                <div class="pub_radio" style="padding-left: 10px;width:350px;"><input type="radio" name="skutype" value="-1" class="check_box skutype fl" checked><span class="fl">不限库存</span><input type="radio" name="skutype" value="999" class="check_box skutype fl"><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="hidden" name="data[sale_sku]" class="int" value="<{$detail.sale_sku}>"></div>                                                <{else}>                                                                                                <div class="pub_radio" style="padding-left: 10px;width:350px;"><input type="radio" name="skutype" value="-1" class="check_box skutype fl" ><span class="fl">不限库存</span><input type="radio" name="skutype" value="999" class="check_box skutype fl" checked><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="text" name="data[sale_sku]" class="int" value="<{$detail.sale_sku}>"></div>                                                <{/if}>                                            </td>                                            <td class="cz"><span class="black9"></span></td>                                        </tr>                                        <{else}>                                            <{foreach $spec_lists as $list}>                                                <tr class="int_box">                                                    <td><input type="text" name="datas[<{$list@index+1}>][spec_name]" value="<{$list.spec_name}>" class="int"></td>                                                    <td><input type="text" name="datas[<{$list@index+1}>][price]" value="<{$list.price}>" class="int"></td>                                                    <td><input type="text" name="datas[<{$list@index+1}>][package_price]" value="<{$list.package_price}>" class="int"></td>                                                    <!-- <td><input type="text" name="datas[<{$list@index+1}>][sale_sku]" value="<{$list.sale_sku}>" class="int"></td> -->                                                    <td style="text-align: left;width: 350px;height:32px;line-height:32px">                                                    <{if $list.sale_type == 0}>                                                                                                       <div class="pub_radio" style="padding-left: 10px;width:350px;"><input type="radio" name="skutype[<{$list@index+1}>]" value="-1" class="check_box skutype fl" checked><span class="fl">不限库存</span><input type="radio" name="skutype[<{$list@index+1}>]" value="999" class="check_box skutype fl"><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="hidden" name="datas[<{$list@index+1}>][sale_sku]" class="int" value="-1"></div>                                                    <{else}>                                                                                                        <div class="pub_radio" style="padding-left: 10px;width:350px;"><input type="radio" name="skutype[<{$list@index+1}>]" value="-1" class="check_box skutype fl"><span class="fl">不限库存</span><input type="radio" name="skutype[<{$list@index+1}>]" value="999" class="check_box skutype fl" checked><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="text" name="datas[<{$list@index+1}>][sale_sku]" class="int" value="<{$list.sale_sku}>"></div>                                                    <{/if}>                                                    </td>                                                    <!-- <td><a class="btn btn-primary btn-sm upload_img_btn">图片上传 <input type="file" name="data[photo][<{$list@index+1}>]" id="photo_<{$list@index+1}>" onchange="fileSelected(this,<{$list@index+1}>)" class="scimg_int" /></a><span class="preview img_<{$list@index+1}>" rel="<{$pager.img}>/<{$list.spec_photo}>">预览</span></td> -->                                                    <td class="cz"><span class="black9 ml20"></span><a href="javascript:;" class="fa fa-times-circle clear_btn"></a></td>                                                </tr>                                            <{/foreach}>                                        <{/if}>                                    </table>                                    <a href="javascript:;" class="btn btn-primary btn-sm btn-outline add_btn">添加规格</a>                                </div>                            </div>                        </div>                    </td>                </tr>                <tr>                    <td><p class="form_table_t"><em>·</em>商品属性：</p></td>                    <td>                        <div class="goodsCate">                            <input type="hidden" id="attr_name" name="data[attr_name]" value="">                            <input type="hidden" id="attr_val" name="data[attr_val]" value="">                            <div id="list_box_attr">                                <{foreach $detail['specification'] as $k=>$v}>                                <div class="cate_list normslist " rel="<{$k}>">                                <div class="cate_one">                                    <input type="text" rel="<{$k}>" name="data[key][<{$k}>]" class="jq_attr_name  " id="attr_key<{$k}>"  placeholder="规格名称" value="<{$v.key}>">                                    <a href="javascript:;" rel="" class="clear_btn fr j-delNorms reformat_remove_ye " rel="<{$k}>"><i class="fa fa-trash"></i>移除</a>                                    </div>                                <div class="cate_two">                                    <div class="skuitemPanel">                                        <ul class="labelList" id="labelList_<{$k}>">                                            <{foreach $v['val'] as $vv}>                                            <li rel="<{$k}>" class="attr_val" data="" ><input type="hidden" name="data[val][<{$k}>][]" value="<{$vv}>"/><div class="box"><span><i><{$vv}></i></span><i class="fa fa-close gicon-remove" rel=""></i></div></li>                                            <{/foreach}>                                            </ul>                                        <div class="add_box">                                            <input type="text" class="input" value=""  id="attr_tmp_<{trim($k)}>'">                                            </div>                                        <a href="javascript:;" class="btn btn-primary btn-sm attr_val_add" rel="<{$k}>">添加</a>                                        </div>                                    </div>                                </div>                                <{/foreach}>                            </div>                            <a href="javascript:;" class="sku-add" title="添加规格">+</a>                        </div>                    </td>                </tr>                <tr>                    <td><p class="form_table_t">售卖状态：</p></td>                    <td>                        <div class="form_table_nr">                            <label class="mr30"><input type="radio" name="data[is_onsale]" <{if $detail.is_onsale == 1}>checked="checked"<{/if}> value="1" class="check_box" />上架</label>                            <label class="mr30"><input type="radio" name="data[is_onsale]" <{if $detail.is_onsale == 0}>checked="checked"<{/if}> value="0" class="check_box" />下架</label>                        </div>                    </td>                </tr>                <tr>                    <td width="120"><p class="form_table_t">商品排序：</p></td>                    <td><div class="form_table_nr"><input type="text" name="data[orderby]" value="<{$detail.orderby|default:50}>" class="form_table_int form_table_intw1" /></div></td>                </tr>                <tr>                    <td><p class="form_table_t">商品简介：</p></td>                    <td><div class="form_table_nr"><textarea name="data[intro]" class="form_table_int form_table_textarea"><{$detail.intro}></textarea></div></td>                </tr>            </table>            <div class="form_table_btn_box text_c">                <input class="btn btn-primary btn-w-m sub_btn" type="submit" value="保存" />                <a class="btn btn-default btn-w-m" href="<{link ctl='product/product/index'}>">取消</a>            </div>        </form>        </div>        <!--表单end-->    </div>    <div id="preview" class="none"><img class="jq_preview" src="" width="200" height="200"/></div>    <!--规格编辑-->    <script>        $(document).ready(function () {            var num = "<{$num+1}>";            var j = num;            var i = num;            $(".spec_mask1 .add_btn").click(function () {                var price = '';                var package_price = '';                var sale_sku = -1;                if(j==1){                    price = $('#first_box input[name="data[price]"]').val();                    package_price = $('#first_box input[name="data[package_price]"]').val();                    sale_sku = $('#first_box input[name="data[sale_sku]"]').val();                    $(".tit").hide();                    $(".tit_spec").show();                    $("#first_box").remove();                }                                var html = '<tr class="int_box">';                html += '<td><input type="text" name="datas['+i+'][spec_name]" class="int"></td>';                html += '<td><input type="text" name="datas['+i+'][price]" class="int" value="'+price+'"></td>';                html += '<td><input type="text" name="datas['+i+'][package_price]" class="int" value="'+package_price+'"></td>';                if(sale_sku == -1){                    html += '<td style="text-align: left;width: 350px;height:32px;line-height:32px"><div class="pub_radio" style="padding-left: 10px;width:350px;"><input type="radio" name="skutype['+i+']" value="-1" class="check_box skutype fl" checked><span class="fl">不限库存</span><input type="radio" name="skutype['+i+']" value="999" class="check_box skutype fl"><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="hidden" name="datas['+i+'][sale_sku]" class="int fl" value="-1"></div></td>';                }else{                    sale_sku = parseInt(sale_sku);                    html += '<td style="text-align: left;width: 350px;height:32px;line-height:32px"><div class="pub_radio" style="padding-left: 10px;width:350px;"><input type="radio" name="skutype['+i+']" value="-1" class="check_box skutype fl"><span class="fl">不限库存</span><input type="radio" name="skutype['+i+']" value="'+sale_sku+'" class="check_box skutype fl" checked><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="text" name="datas['+i+'][sale_sku]" class="int fl" value="'+sale_sku+'"></div></td>';                }                                //html += '<td><a class="btn btn-primary btn-sm upload_img_btn">图片上传 <input type="file" name="data[photo]['+i+']" id="photo_'+i+'" onchange="fileSelected(this,'+i+')" class="scimg_int" /></a><span class="preview img_'+i+'" rel="">预览</span></td>';                html += '<td class="cz"><span class="ml20"><a href="javascript:;" class="fa fa-times-circle clear_btn"></a></span></td>';                html += '</tr>';                $(this).parents(".spec_mask1").find(".table_box table").append(html);                i++;                j++;                /*$(".spec_mask1 .cont table tr td .clear_btn").click(function () {                    $(this).parents("tr.int_box").remove();                });*/            });            $(document).on('change','.skutype',function(){//自定义和不限库存                var val = $(this).val();                if(val > 0){                   $(this).siblings('.int').attr('type','text').val(val);                 }else{                    $(this).siblings('.int').attr('type','hidden').val(val);                }            });            $(document).on("click",".spec_mask1 .cont table tr td .clear_btn",function(){                j--;                $(this).parents("tr.int_box").remove();                if(j==1){                    $(".tit").show();                    $(".tit_spec").hide();                    $(".spec_mask1 .cont table").append('<tr class="int_box" id="first_box"><td><input type="text" name="data[price]" class="int"></td><td><input type="text" name="data[package_price]" class="int"></td><td style="text-align: left;padding-left: 10px;width: 350px;height:32px;line-height:32px"><div class="pub_radio"><input type="radio" name="skutype" value="-1" class="check_box skutype fl" checked><span class="fl">不限库存</span><input type="radio" name="skutype" value="999" class="check_box skutype fl"><span class="fl">自定义库存&nbsp;&nbsp;&nbsp;</span><input type="hidden" name="data[sale_sku]" class="int fl" value="-1"></div></td><td class="cz"><span class="black9"></span></td></tr>');                }            });            $(document).on("click",".preview",function(){                var pre = '<{$pager.img}>/'                if($(this).attr("rel") == ""||$(this).attr("rel")==0||$(this).attr("rel")==pre){                    layer.msg("没有上传图片");                }else{                    $(".jq_preview").attr("src",$(this).attr("rel"));                    layer.open({                        type: 1,                        title: false,                        closeBtn: 1,                        area: '200px',                        skin: 'layui-layer-nobg', //没有背景色                        shadeClose: true,                        content: $('#preview')                    });                }            })        });        //商家分类        var json_cates = <{$json_scates}>;        var cate_id = "<{$cate_id}>";        var cate_id2 = "<{$cate_id2}>";        select(json_cates,2,cate_id,cate_id2);        //系统分类        var json_xcates = <{$json_xcates}>;        var cat_id = "<{$cat_id}>";        var cat_id2 = "<{$cat_id2}>";        var cat_id3 = "<{$cat_id3}>";        select2(json_xcates,3,cat_id,cat_id2,cat_id3);    </script>    <!--规格编辑end-->    <script>        $(function(){            remove_sku();            $('.attr_val_add').off().on('click',function(){                var index_key = $(this).attr('rel');                var val = $('#attr_key'+index_key).val();                if(!val){                    layer.msg('请填写属性名称');                    return false;                }                var attr_val = $(this).parent().children('.add_box').find('input').val();                if(!attr_val){                    layer.msg('请填写属性值');                    return false;                }                var html = '<li rel="'+index_key+'" class="attr_val" data="'+attr_val+'" ><input type="hidden" name="data[val]['+index_key+'][]" value="'+attr_val+'"/><div class="box"><span><i>'+attr_val+'</i></span><i class="fa fa-close gicon-remove" rel=""></i></div></li>';                $('#labelList_'+index_key).append(html);                $(this).parent().children('.add_box').find('input').val("");                remove_attr();            })            remove_attr();        })        $('.sku-add').on('click',function(){            add_sku();        })        function add_sku(){            var j = $(".normslist:last").attr("rel");            if(j==undefined){                j = 1;            }else{                j = parseInt(j)+1;            }            var html = '<div class="cate_list normslist " rel="'+j+'">'+                    '<div class="cate_one">'+                    '<input type="text" rel="'+j+'" name="data[key]['+j+']" class="jq_attr_name  " id="attr_key'+j+'"  placeholder="属性名称">'+                    '<a href="javascript:;" rel="" class="clear_btn fr j-delNorms reformat_remove_ye " rel="'+j+'"><i class="fa fa-trash"></i>移除</a>'+                    '</div>'+                    '<div class="cate_two">'+                    '<div class="skuitemPanel">'+                    '<ul class="labelList" id="labelList_'+j+'">'+                    '</ul>'+                    '<div class="add_box">'+                    '<input type="text" class="input" value="" id="attr_tmp_'+j+'">'+                    '</div>'+                    '<a href="javascript:;" class="btn btn-primary btn-sm attr_val_add" rel="'+j+'">添加</a>'+                    '</div>'+                    '</div>'+                    '</div>';            $('#list_box_attr').append(html);            remove_sku();            attr_add();        }        function remove_sku(){            $('.reformat_remove_ye').off().on('click',function(){                $(this).parent().parent().remove();            })        }        function remove_attr(){            $('.gicon-remove').off().on('click',function(){                $(this).parent().parent().remove();            })        }        function attr_add(){            $('.attr_val_add').off().on('click',function(){                var index_key = $(this).attr('rel');                var val = $('#attr_key'+index_key).val();                if(!val){                    layer.msg('请填写属性名称');                    return false;                }                var attr_val = $('#attr_tmp_'+index_key).val();                if(!attr_val){                    layer.msg('请填写属性值');                    return false;                }                var html = '<li rel="'+index_key+'" class="attr_val" data="'+attr_val+'" ><input type="hidden" name="data[val]['+index_key+'][]" value="'+attr_val+'"/><div class="box"><span><i>'+attr_val+'</i></span><i class="fa fa-close gicon-remove" rel=""></i></div></li>';                $('#labelList_'+index_key).append(html);                $('#attr_tmp_'+index_key).val("");                remove_attr();            })        }    </script>    <{include file="block/footer.html"}>