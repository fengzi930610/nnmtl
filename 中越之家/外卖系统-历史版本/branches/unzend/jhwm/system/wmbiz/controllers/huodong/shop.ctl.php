<?php/** * Copy Right IJH.CC * Each engineer has a duty to keep the code elegant * $Id: index.ctl.php 14351 2016-01-14 01:25:14Z youyi $ */if(!defined('__CORE_DIR')){    exit("Access Denied");}class Ctl_Huodong_Shop extends Ctl{    public function index()    {//各种活动分开处理        //满减活动        if(!$manjian =  K::M('waimai/huodongmj')->find(array('shop_id'=>$this->shop_id,'closed'=>0,'stime'=>'<:'.__TIME,'ltime'=>'>:'.__TIME))){            $manjian = K::M('waimai/huodongmj')->find(array('shop_id'=>$this->shop_id,'closed'=>0));        }        if($manjian){            $manjian['coupons'] = $manjian['config'];        }        //满返活动        if(!$manfan = K::M('waimai/huodongmf')->find(array('shop_id'=>$this->shop_id,'closed'=>0,'stime'=>'<:'.__TIME,'ltime'=>'>:'.__TIME))){            $manfan = K::M('waimai/huodongmf')->find(array('shop_id'=>$this->shop_id,'closed'=>0));        }        if($manfan){            $manfan['coupons'] = $manfan['config'];        }        //送券活动        if(!$coupon = K::M('waimai/huodongcoupon')->find(array('shop_id'=>$this->shop_id,'closed'=>0,'stime'=>'<:'.__TIME,'ltime'=>'>:'.__TIME))){            $coupon = K::M('waimai/huodongcoupon')->find(array('shop_id'=>$this->shop_id,'closed'=>0));        }        if($coupon){            $coupon['coupons'] = $coupon['config'];        }        //首单优惠        if(!$first_youhui = K::M('waimai/huodongfirst')->find(array('shop_id'=>$this->shop_id,'closed'=>0,'stime'=>'<:'.__TIME,'ltime'=>'>:'.__TIME))){            $first_youhui = K::M('waimai/huodongfirst')->find(array('shop_id'=>$this->shop_id,'closed'=>0));        }        //限时折扣        if(!$discount = K::M('waimai/huodongdiscount')->find(array('shop_id'=>$this->shop_id,'closed'=>0,'stime'=>'<:'.__TIME,'ltime'=>'>:'.__TIME))){            $discount = K::M('waimai/huodongdiscount')->find(array('shop_id'=>$this->shop_id,'closed'=>0));        }        //超值换购        if(!$huangou = K::M('waimai/huodonghuangou')->find(array('shop_id'=>$this->shop_id,'closed'=>0,'stime'=>'<:'.__TIME,'ltime'=>'>:'.__TIME))){            $huangou = K::M('waimai/huodonghuangou')->find(array('shop_id'=>$this->shop_id,'closed'=>0));        }                $this->pagedata['coupon'] = $coupon;        $this->pagedata['manfan'] = $manfan;        $this->pagedata['manjian'] = $manjian;        $this->pagedata['first'] = $first_youhui;        $this->pagedata['discount'] = $discount;        $this->pagedata['huangou'] = $huangou;        $this->tmpl = 'huodong/shop.html';    }}