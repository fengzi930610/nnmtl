<{assign var='tpl_title' value=L("外卖商家列表")}>
<{include file="waimai/block/header.html"}>
<style type="text/css">
    #pubnodata{ background: #eef2f5}
    .top_appDown{z-index: 101;}
    .top_appDown ~ .takeout-list-mask{top:50px;}
    
    .page{
        background-color: #FFF;
    }
    .page_cont{
        height: auto;
    }
    /*头部*/
    .header{
        width: 100%;
        height: 50px;
        background-color: #fff;
    }
    .header .city{
        position: relative;
        float: left;
        text-align: center;
        width: 30px;
        height: 50px;
        margin: 0 auto;
    }
    /* .header .city{
        position: relative;
        float: left;
        text-align: center;
        width: 65px;
        height: 50px;
        margin: 0 auto;
    } */
    .header .city a{
        font-size: 24px;
        font-weight: bold;
        line-height: 50px;
        color: rgb(207, 124, 45);
        vertical-align: top;
    }
    .header .title{
        width: 100%;
        text-align: center;
        font-size: 18px;
        line-height: 46px;
        display: inline-block;
    }
    .header .back{
        position:absolute;
        left: 14px;
        top: 20px;
        width: 12px;
        height: 16px;
        background-image: url(../../../themes/waimai/static/images/arrow-r@2x.png);
        background-repeat: no-repeat;
        background-size: cover;
        margin-top: -6px;
        transform:rotateY(180deg);
    }
    .header .city i{
        position:absolute;
        left: 58px;
        top: 50%;
        width: 12px;
        height: 8px;
        background-image: url(../../../themes/waimai/static/img/new4.0/index/to_btn_arrowd@3x.png);
        background-repeat: no-repeat;
        background-size: cover;
        margin-top: -4px;
    }
    .header .search_ico{
        position: absolute;
        right: 15px;
        top: 14px;
        width: 18px;
        height: 18px;
        background-image: url(../../../themes/waimai/static/img/new4.0/index/icon_search@3x.png);
        background-repeat: no-repeat;
        background-size: cover;
    }
    .banner{
        width: 100%;
        margin: 0 auto;
        background-color: #fff;
    }
    .idxBanner{
        padding:8px;
    }
    .idxBanner .swiper-wrapper .swiper-slide a {
        display: block;
        width: 100%;
        padding: 19.4% 0;
        height: 0;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        background-color: #f7f7f7;
        border-radius: 4px;
        overflow: hidden;
    }
    .type{
        width: 100%;
        background-color: #fff;
        margin: 0 auto;
    }
    .type ul li{
        text-align: center;
        width: 19%;
        margin: 5px auto;
        vertical-align: top;
        display: inline-block;
    }
    .type ul li img{
        width: 60%;
        display: inline-block;
    }
    .type ul li span{
        width: 100%;
        margin-top: 6px;
        display: inline-block;
    }
    .type_box{
        width: 100%;
        height: 36px;
        background-color: #fff;
        border-bottom: 1px solid #eee;
    }
    .type_box ul li{
        width: 32.6%;
        height: 36px;
        text-align: center;
        line-height: 36px;
        font-size: 16px;
        margin: 0 auto;
        display: inline-block;
    }
    .type_box ul li a{
        position: relative;
    }
    .type_box ul li a::after{
        content: "";
        position: absolute;
        top: 2px;
        left: -25px;
        width: 20px;
        height: 20px;
        background-image: url(../../../themes/waimai/static/img/new4.0/btn_radio@3x.png);
        background-size: cover;
    }
    .type_box ul .active ::after{
        background-image: url(../../../themes/waimai/static/img/new4.0/btn_radio_selected@3x.png);
    }
    .idxTitle{
        background-size: cover;
    }
    .list_title{
        text-align: center;
        font-size: 16px;
        padding: 6px 12px;
        border: 1px solid #EEE;
        border-left: none;
        border-right: none;
        font-weight: bolder;
        margin-top: 12px;
    }
</style>
<div class="container" id="ScrollListener" style="position:static; height:100%;overflow-y: scroll;">
    <div class="page js_show" id="ScrollLayer" style="position: relative;">
        <div class="page_cont">
            <{include file="waimai/block/qucikly.html"}>
            <!-- 新增头部 -->
            <div class="header"><a class="back" href="<{link ctl='index' http='waimai'}>"></a><!-- <div class="city"><{if false}><a id="CurSelCity">河内</a><i></i><{/if}></div>--><span class="title"><{$title}></span><a class="search_ico" href="<{link ctl='shoplist/search' arg0=1 http='waimai'}>"></a></div>
            <{if $theme_config AND is_array($theme_config)}>
            <{foreach $theme_config as $k=>$module}>
            <{if $module.module=='module2'}>
            <div class="banner" style="background-image: url(''); background-color:<{if $module.background_color}>#<{$module.background_color}><{else}>transparent<{/if}>;">
                <div class="idxBanner">
                    <div class="swiper-container" ref="idxBanner">
                        <div class="swiper-wrapper">
                            <{foreach $module.content as $kk=>$vv}>
                            <div class="swiper-slide">
                                <a style="background-image: url('<{$vv.photo}>');" title="" href="<{$vv.link|default:'javascript:void(0);'}>"></a>
                            </div>
                            <{/foreach}>
                        </div>
                        <{if count($module.content) > 1}>
                        <div class="swiper-pagination"></div>
                        <{/if}>
                    </div>
                </div>
            </div>
            <{break}>
            <{/if}>
            <{/foreach}>
            <{/if}>
            <div class="type">
                <div class="typelist">
                        <ul id="RecCateList">
                            <{foreach $cates as $v}>
                            <{if $v.childrens}>
                            <{foreach $v.childrens as $sv}>
                            <{if $sv.is_rec>0 AND $sv.parent_id==$cate_id}>
                            <!-- <li class="swiper-slide" onclick="selCate(this);" parent-id="<{$sv.parent_id}>" self-id="<{$sv.cate_id}>" cate-id="<{$sv.cate_id}>"><a href="javascript:void(0);"><{if $sv.icon!=""}><img src="<{$pager.img}>/<{$sv.icon}>"><{else}><img src="../../../themes/waimai/static/img/Group6@2x.png" title="默认图标"><{/if}><span><{$sv.title}></span></a></li> -->
                            <li class="swiper-slide" parent-id="<{$sv.parent_id}>" self-id="<{$sv.cate_id}>" cate-id="<{$sv.cate_id}>"><a href="<{link ctl='shoplist/index' http='waimai' arg0=$sv.cate_id _st='1'}>"><{if $sv.icon!=""}><img src="<{$pager.img}>/<{$sv.icon}>"><{else}><img src="../../../themes/waimai/static/img/Group6@2x.png" title="默认图标"><{/if}><span><{$sv.title}></span></a></li>
                            <{/if}>
                            <{/foreach}>
                            <{/if}>
                            <!-- <li class="swiper-slide"><a><img src="../../../themes/waimai/static/img/Group3@2x.png"><span>午餐</span></a></li>-->
                            <{/foreach}>
                        </ul>
                    </div>
                </div>
            </div>
            <{if $theme_config AND is_array($theme_config)}>
            <{foreach $theme_config as $k=>$module}>
            <{if $module.module=='module5' || $module.module=='module6'}>
            <div class="WMhome" style="background-color:<{if $module.background_color}>#<{$module.background_color}><{else}>transparent<{/if}>;">
                <a class="idxTitle" style="background-image: url('<{$module.photo}>');background-position: left center;" href="<{$module.link|default:'javascript:;'}>">
                    <!-- <h1>优惠专区</h1> -->
                </a>
                <!--左右滑动-->
                <{if $module.type==1 || !$module.type}>
                <div class="preferentialAarea preferentialAarea1 mb10">
                <{else if $module.type==2}>
                <div class="preferentialAarea preferentialAarea2 mb10">
                <{else if $module.type==3}>
                <div class="preferentialAarea preferentialAarea3 mb10">
                <{else if $module.type==4}>
                <div class="preferentialAarea preferentialAarea4 mb10">
                <{else if $module.type==5}>
                <div class="preferentialAarea preferentialAarea5 mb10">
                <{else if $module.type==6}>
                <div class="preferentialAarea preferentialAarea6 mb10">
                <{else if $module.type==7}>
                <div class="preferentialAarea preferentialAarea7 mb10">
                <{else}>
                <div class="preferentialAarea preferentialAarea1 mb10">
                <{/if}>
                    <ul>
                        <{foreach $module.content as $kk=>$vv}>
                        <li style="background-image: url('<{$vv.photo}>');"><a href="<{$vv.link|default:'javascript:;'}>"></a></li>
                        <{/foreach}>
                    </ul>
                </div>
            </div>
            <{/if}>
            <{/foreach}>
            <{/if}>
            <!-- <div class="recommend">
                <h2>推荐专区</h2>
                <div class="cateNav col5" style="background-image: url(''); background-color:transparent;">
                    <div class="swiper-container" ref="cateNav" style="background: transparent;">
                        <ul class="swiper-wrapper">
                            <li class="swiper-slide"><a><img src="https://img01.jhcms.com/wmdemo/photo/201802/20180205_3C04700D301AE8078995A4310D7BFD9B.jpg"><span>推荐1</span></a></li>
                            <li class="swiper-slide"><a><img src="https://img01.jhcms.com/wmdemo/photo/201802/20180205_3C04700D301AE8078995A4310D7BFD9B.jpg"><span>推荐2</span></a></li>
                            <li class="swiper-slide"><a><img src="https://img01.jhcms.com/wmdemo/photo/201802/20180205_3C04700D301AE8078995A4310D7BFD9B.jpg"><span>推荐3</span></a></li>
                            <li class="swiper-slide"><a><img src="https://img01.jhcms.com/wmdemo/photo/201802/20180205_3C04700D301AE8078995A4310D7BFD9B.jpg"><span>推荐4</span></a></li>
                            <li class="swiper-slide"><a><img src="https://img01.jhcms.com/wmdemo/photo/201802/20180205_3C04700D301AE8078995A4310D7BFD9B.jpg"><span>推荐5</span></a></li>
                        </ul>
                    </div>
                </div>
            </div> -->
            <div class="list_title">附近的店铺</div>
            <{if false}><!-- //禁用店铺类型 -->
            <div class="type_box">
                <ul id="TypeSel">
                    <li>附近店铺</li>
                    <li vcode="cn"><a>中国人店</a></li>
                    <li vcode="vn"><a>越南人店</a></li>
                </ul>
            </div>
            <{/if}>
            <!-- 新增头部结束 -->
            <div class="takeout-list-title border_b" style="display: none;">
                <a class="list" href="javascript:;">全部分类</a>
                <span class="line"></span>
                <a class="list" href="javascript:;">排序</a>
                <span class="line"></span>
                <a class="list" href="javascript:;">筛选</a>
            </div>
            <div class="takeout-list-mask">
                <div class="mask-list">
                    <div class="list">
                        <div class="left fl" style="background: #f4f4f4">
                            <ul>
                                <li onclick="selCate(this);" parent-id="0" self-id="0" cat-id="0"><a href="javascript:;">全部分类<span></span></a></li>
                                <{foreach $cates as $v}>
                                <{if $v.childrens}>
                                <li parent-id="<{$v.parent_id}>" cat-id="<{$v.cate_id}>" <{if $cate_id==$v.cate_id}> class="on"<{/if}>><a href="javascript:;"><{$v.title}><span></span></a></li>
                                <{else}>
                                <li onclick="selCate(this);" parent-id="<{$v.parent_id}>" self-id="<{$v.cate_id}>" cat-id="<{$v.cate_id}>" <{if $cat_id==$v.cate_id}> class="on"<{/if}> ><a href="javascript:;"><{$v.title}><span></span></a></li>
                                <{/if}>
                                <{/foreach}>
                            </ul>
                        </div>
                        <div class="right fr">
                            <ul>
                                <li class="right_list takeout_wu" style="display: none" cat-id="0">当前为全部类目</li>
                                <{foreach $cates as $cate}>
                                <li class="right_list" cat-id="<{$cate.cate_id}>" <{if $cate_id==$cate.cate_id}>style='display:block;'<{/if}>>
                                    <ul>
                                        <li onclick="selCate(this);" parent-id="<{$cate.cate_id}>" self-id="0" cate-id="0"><a href="javascript:;">全部</a></li>
                                        <{foreach $cate.childrens as $vo}>
                                        <li onclick="selCate(this);" parent-id="<{$vo.parent_id}>" self-id="<{$vo.cate_id}>" cate-id="<{$vo.cate_id}>"><a href="javascript:;"><{$vo.title}></a></li>
                                        <{/foreach}>
                                    </ul>
                                </li>
                                <{/foreach}>
                            </ul>
                        </div>
                    </div>
                    <div class="takeout_mask-bg"></div>
                </div>
                <div class="mask-list">
                    <div class="order">
                        <ul>
                            <li onclick="setloadparams('orderby','default');" orderby="default"><a href="javascript:;">智能排序</a></li>
                            <li onclick="setloadparams('orderby','juli');" orderby="juli"><a href="javascript:;">距离最近</a></li>
                            <li onclick="setloadparams('orderby','pingfen');" orderby="pingfen"><a href="javascript:;">评分最高</a></li>
                            <li onclick="setloadparams('orderby','sales');" orderby="sales"><a href="javascript:;">销售最高</a></li>
                            <li onclick="setloadparams('orderby','minprice');" orderby="minprice"><a href="javascript:;">起送价最低</a></li>
                            <{if false}><li onclick="setloadparams('orderby','song');" orderby="song"><a href="javascript:;">最早送达</a></li><{/if}>
                        </ul>
                    </div>
                    <div class="takeout_mask-bg"></div>
                </div>
                <div class="mask-list">
                    <div class="choose_box">
                        <div class="choose" id="choosebox">
                            <div class="way">
                                <p class="title black9"><!-- <i class="ico_way"></i> -->配送方式</p>
                                <div class="tips">
                                    <a href="javascript:;">不限<input type="radio" name="way" rel-key="pei_type" rel-val="0"></a>
                                    <a href="javascript:;">平台送<input type="radio" name="way" rel-key="pei_type" rel-val="2"></a>
                                    <a href="javascript:;">商家送<input type="radio" name="way" rel-key="pei_type" rel-val="1"></a>
                                </div>
                            </div>
                            <div class="infor">
                                <p class="title black9"><!-- <i class="ico_infor"></i> -->优惠信息</p>
                                <div class="tips">
                                    <a href="javascript:;">满减优惠<input type="radio" name="infor" rel-key="youhui" rel-val="mj"></a>
                                    <a href="javascript:;">满返优惠<input type="radio" name="infor" rel-key="youhui" rel-val="mf"></a>
                                    <a href="javascript:;">首单优惠<input type="radio" name="infor" rel-key="youhui" rel-val="sd"></a>
                                    <a href="javascript:;">优惠券<input type="radio" name="infor" rel-key="youhui" rel-val="yhj"></a>
                                </div>
                            </div>
                            <div class="tese">
                                <p class="title black9"><!-- <i class="ico_te"></i> -->商家特色</p>
                                <div class="tips">
                                    <a href="javascript:;">免配送费<input  type="radio" name="tese" rel-key="ts" rel-val="mian"></a>
                                    <a href="javascript:;">0元起送<input  type="radio" name="tese" rel-key="ts" rel-val="zero"></a>
                                </div>
                            </div>
                        </div>
                        <div class="btns">
                            <a href="javascript:;" class="reset_btn">清空</a>
                            <a href="javascript:;" id="confirm_btn" class="confirm_btn">确定</a>
                        </div>
                    </div>
                    <div class="takeout_mask-bg"></div>
                </div>
            </div>

            <div class="container_mid">
                <div class="shoplists_box WMhome" id="index_goods_items">
                                
                </div>
                <div class="loadding" style="">
                </div>
                <div class="pubnodata" style="">
                </div>
            </div>
            <!-- 附近推荐商铺结束 -->
        </div>
    </div>
</div>

<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="/static/cdn/js/swiper.min.js"></script>

<!-- Initialize Swiper -->
<script>
    // var swiper = new Swiper('.swiper-container', {
    //     pagination: '.swiper-pagination',
    //     slidesPerView: 1,
    //     paginationClickable: true,
    //     spaceBetween: 0,
    //     loop: true
    // });
</script>
<script type="text/javascript">
    var cateSwiper = null;
    // $('.type_box ul li').click(function(){
    //     $(this).addClass('active').siblings().removeClass('active');
    // });
    $(document).ready(function() {
        //轮播图
        var mySwiper1 = new Swiper ('.idxBanner .swiper-container', {
            autoplay: 3000,//可选选项，自动滑动
            autoplayDisableOnInteraction : false,//设置为false，用户操作swiper之后自动切换不会停止，每次都会重新启动autoplay
            loop : true,
            pagination: '.idxBanner .swiper-pagination',
        });
        // var mySwiper3 = new Swiper ('.cateNav .swiper-container', {
        //     autoplay: false,//可选选项，自动滑动    
        //     slidesPerView: 'auto',
        //     pagination: '.cateNav .swiper-pagination',
        // });
    });

    //<{if false}><!-- //禁用店铺类型 -->
    //店铺类型选择筛选
    $("#TypeSel li[vcode]").on("click",function(){
        if($(this).hasClass("active"))
        {
            parmas.country_code = "";
            $(this).removeClass("active");
        }
        else
        {
            $(this).siblings("[vcode]").removeClass("active");
            $(this).addClass("active");
            parmas.country_code = $(this).attr("vcode");
        }
        loadshopsdata();
    });
    //<{/if}>

    $('.takeout-list-mask .left ul li').click(function(){
        var tk_idx=$(this).index();
        $(this).addClass('on').siblings().removeClass('on');
        $(this).parents(".list").find('.right .right_list').eq(tk_idx).show().siblings().hide();
        var value=$(this).text();
        avalue=value.split('(');
        value=avalue[0];
        var ind=$(this).parents('.mask-list').index()
        $('.takeout-list-title .list').eq(ind).text(value);
        if($(this).parents(".list").find('.right .right_list').eq(tk_idx).find('li').length <= 1 ){
            $(this).parents(".list").find('.right .right_list').eq(tk_idx).find('li').addClass('on');
            $('.takeout-list-mask,.mask-list').hide();
            $('.takeout-list-title .list').removeClass('on')
        }
    })

    $('.takeout-list-mask .right .right_list li').click(function(){
        $(this).addClass('on').siblings().removeClass('on');
        $('.takeout-list-title .list').removeClass('on')
        $('.takeout-list-mask,.mask-list').hide()
    })

    if($('.takeout-list-title').length > 0){
        $('.takeout-list-title a.list').width(100 / $('.takeout-list-title a.list').length + '%');
    }

    $('.takeout-list-title a.list').click(function(){
        $(this).toggleClass('on').siblings().removeClass('on');
        $('.takeout-list-mask').show();
        var ind=$(this).index();
        $('.takeout-list-mask .mask-list').eq(ind/2).toggle().siblings().hide();
        if($(this).hasClass("on")){
            $('.takeout-list-mask').show();
        }else{
            $('.takeout-list-mask').hide();
        }
    })

    $('.takeout-list-mask .choose a').click(function(){
        $(this).addClass('on').siblings().removeClass('on');
    })

    $('.takeout-list-mask .choose_box .reset_btn').click(function(){
        $('.takeout-list-mask .choose a').removeClass('on');
        parmas['pei_type'] = '';
        parmas['youhui'] = '';
        parmas['ts'] = '';
    })

    $('.takeout_mask-bg').click(function(){
        $('.takeout-list-mask').hide()
        $('.takeout-list-mask .mask-list').hide();
        $('.takeout-list-title a').removeClass('on');
        addClassOn();
    })

    $('.mask-list .order li,.mask-list .choose_box li').click(function(){
        $(this).addClass('on').siblings().removeClass('on');
        $('.takeout-list-mask,.mask-list').hide();
        $('.takeout-list-title .list').removeClass('on')
    })

    //商家列表活动展开与折叠
    $(document).on('touchstart','.WMhome .shoplists .hd .right',function(e){
        event.preventDefault(); // 阻止默认事件
        event.stopPropagation(); // 阻止冒泡
        if($(this).hasClass('on')){
            $(this).parents(".hd").find("ul").removeClass('on');
            $(this).removeClass('on');
        }
        else{
            $(this).parents(".hd").find("ul").addClass('on');
            $(this).addClass('on');
        };
    });

    //商家列表加载js----------------------------------------------------------------------
    var cat_id = parseInt("<{$cate_id}>");
    cat_id = isNaN(cat_id)?0:cat_id;
    var oldFirstCateId = Number(cat_id);
    var cate_id = parseInt("<{$cat_id}>");
    cate_id = isNaN(cate_id)?0:cate_id;
    var title = "<{$title|default:''}>";
    var parmas = JSON.parse(sessionStorage['page_shoplist_parmas'] || '{"cat_id": "'+cat_id+'", "cate_id": "'+cate_id+'", "title": "'+title+'"}');
    parmas.orderby = "juli";
    parmas.cat_id = cat_id;
    parmas.cate_id = cate_id;
    parmas.country_code = "";//禁用店铺类型筛选

    var link = "<{link ctl='shoplist/loadshops' arg0='#page#' http='waimai'}>";
    var page = 1;
    parmas.page = page;

    var _PAGE_SHOPLIST_REBACKTOP = JSON.parse(sessionStorage['page_shoplist_rebacktop'] || '{"page":1, "top":0}');
    _PAGE_SHOPLIST_REBACKTOP['page'] = page;
    if(_PAGE_SHOPLIST_REBACKTOP['page'] > 1){
        page = page+'-'+_PAGE_SHOPLIST_REBACKTOP['page'];
        parmas['pagelimit'] = _PAGE_SHOPLIST_REBACKTOP['page'];
    }
    addClassOn();
    setTimeout(function(){
        loadshopsdata();
    },20)
    

    function setloadparams(k,v){
        if(k=='cat_id' || k==="cate_id"){
            return;
        }
        parmas[k] = v;
        $('.takeout-list-mask').hide();

        _PAGE_SHOPLIST_REBACKTOP['top'] = 0;
        parmas['pagelimit'] = 1;
        loadshopsdata();
        addClassOn();
    }

    function selCate(ele){
        var pid = Number($(ele).attr("parent-id"));
        var sid = Number($(ele).attr("self-id"));
        if(pid === 0)
        {
            pid = sid;
            sid = 0;
        }
        oldFirstCateId = Number(parmas.cat_id);
        parmas.cat_id = pid;
        parmas.cate_id = sid;
        addClassOn();
        loadshopsdata();
    }

    $('[type="radio"]').on('click',function(){
        var k = $(this).attr('rel-key');
        var v = $(this).attr('rel-val');
        parmas[k] = v;
    })

    $('#confirm_btn').on('click',function(){
        $('.takeout-list-mask').hide();
        $('.takeout-list-mask,.mask-list').hide();
        $('.takeout-list-title .list').removeClass('on');

        _PAGE_SHOPLIST_REBACKTOP['top'] = 0;
        parmas['pagelimit'] = 1;
        loadshopsdata();
    })

    function loadshopsdata(){
        loadpage(link,parmas,1,'index_goods_items','index_goods_items',function(){
            $("#ScrollLayer").scrollTop(_PAGE_SHOPLIST_REBACKTOP['top']);
            _PAGE_SHOPLIST_REBACKTOP['page'] = 1;
            sessionStorage['page_index_rebacktop'] = JSON.stringify(_PAGE_SHOPLIST_REBACKTOP);
            parmas['pagelimit'] = 1;

            scroll(link,parmas,page,"#ScrollListener","#ScrollLayer",'index_goods_items',function(){
                _PAGE_SHOPLIST_REBACKTOP['page'] = 1;
                sessionStorage['page_index_rebacktop'] = JSON.stringify(_PAGE_SHOPLIST_REBACKTOP);
            });
        });       
    }

    function addClassOn(){
        var catid = parmas['cat_id'] || 0;
        var cateid = parmas['cate_id'] || 0;
        var orderby = parmas['orderby'] || 'juli';
        var pei_type = parmas['pei_type'] || 0;
        var youhui = parmas['youhui'] || '';
        var ts = parmas['ts'] || '';

        $('.takeout-list-mask .mask-list .left li').each(function(){            
            if($(this).attr('cat-id') == catid)
                $(this).addClass('on');
            else
                $(this).removeClass('on');
        });
        $('.takeout-list-mask .mask-list .right .right_list').each(function(){            
            if($(this).attr('cat-id') == catid){
                $(this).show().siblings('.right_list').hide();
            }
        });
        $('.takeout-list-mask .mask-list .right .right_list li').each(function(){            
            if($(this).attr('cate-id') == cateid && $(this).attr('parent-id') == catid){
                $(this).addClass('on');//.siblings('li').removeClass('on');
            } else {
                $(this).removeClass('on');
            }
        });
        $('.takeout-list-mask .mask-list .order li').each(function(){           
            if($(this).attr('orderby') == orderby){ 
                $(this).addClass('on');//.siblings('li').removeClass('on');
            } else {
                $(this).removeClass('on');
            }
        });

        $('.takeout-list-mask .choose a').each(function(){
            var relkey = $(this).find('input').attr('rel-key');
            var relval = $(this).find('input').attr('rel-val');
            if(relkey == 'pei_type' && relval == pei_type){
                $(this).addClass('on');//.siblings('a').removeClass('on');
            } else {
                $(this).removeClass('on');
            }
            if(relkey == 'youhui' && relval == youhui){
                $(this).addClass('on');//.siblings('a').removeClass('on');
            }else{
                $(this).removeClass('on');
            }
            if(relkey == 'ts' && relval == ts){
                $(this).addClass('on');//.siblings('a').removeClass('on');
            } else {
                $(this).removeClass('on');
            }
        });

        $("#RecCateList li").removeClass('on');
        $("#RecCateList li").each(function(){
            if(Number($(this).attr('cate-id')) === Number(parmas.cate_id))
                $(this).addClass('on');
            // if(Number($(this).attr("parent-id")) === Number(parmas.cat_id))
            //     $(this).css("display","inline-block");
            // else
            //     $(this).css("display","none");
        });
        // if(oldFirstCateId !== Number(parmas.cat_id) && cateSwiper)
        //     cateSwiper.update(true);
    }
    if(typeof parmas !== "undefined" && typeof parmas.country_code === "string" && $.trim(parmas.country_code) !== "")
    {
        var itemEle = $("#TypeSel li[vcode='"+parmas.country_code+"']");
        if(itemEle.length > 0)
        {
            itemEle.siblings().removeClass("active");
            itemEle.addClass("active");
        }
    }

    /*返回上次浏览位置*/
    window.onunload = function(){
        sessionStorage['page_shoplist_rebacktop'] = JSON.stringify({"page":pages, "top":$("#ScrollLayer").scrollTop()});
        sessionStorage['page_shoplist_parmas'] = JSON.stringify(parmas);
    }
    /*返回上次浏览位置*/

</script>
<script type="text/javascript">
(function(){
    $("#CurSelCity").parents(".city").eq(0).on("click",function(){
        window.location.href = "<{link ctl='position/index' http='waimai'}>";
    });
    getUxLocation(function(ret){
        if(ret.error===0)
            $('#CurSelCity').text(decodeURI(ret.addr));
    });
})();
</script>
<{include file="waimai/block/footer.html"}>