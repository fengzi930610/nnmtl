<{assign var='tpl_title' value=L("配送员主页")}>
<{include file="waimai/block/header.html"}>
<style type="text/css">
	.staffInfo .info{background: #20AD20; text-align: center; padding: 40px 16px 15px;}
	.staffInfo .info img{border-radius: 100%;}
	.staffInfo .info h3{font-size: 16px; color: #fff; line-height: 20px; margin-top: 10px; font-weight: 500;}
	.staffInfo .bg{line-height: 0; display: block;}
	.staffInfo .info_list{background: #fff; padding: 10px 0; text-align:center; overflow: hidden;}
	.staffInfo .info_list ul li{width: 33.33%; float: left; line-height: 20px;}
	.staffInfo .info_list ul li p{font-size: 12px; color: #999;}
	.staffInfo .info_list ul li .num{font-size: 16px; color: #f60; margin-top: 4px;}
	.staffInfo .info_list ul li .num small{font-size: 12px;}
	.staffInfo .infoTwo_list ul li .num{color: #333; font-size: 15px;}
	.staffInfo .tit{font-size: 16px; font-weight: 500; line-height: 24px; margin-bottom: 8px; text-align: left;}
	.staffInfo .tit small{color: #999; margin-left: 8px; font-size: 12px;}
	.staffInfo .award{background: #fff; padding: 10px 12px;}
	.staffInfo .award ul{overflow: hidden;}
	.staffInfo .award ul li{float: left; width: 25%; text-align: center;}
	.staffInfo .award ul li p{font-size: 12px; color: #999; line-height: 20px;}
	.staffInfo .award .pub_list{padding: 10px 0 0; border-top: 1px solid #e6e6e6; margin-top: 10px;}
	.staffInfo .award .pub_list .img{border-radius: 100%; background: #eee; margin-right: 10px;}
	.staffInfo .score{background: #fff; padding: 10px 12px; text-align: center;}
	.staffInfo .score a{display: inline-block;background: #FFEBDE;border-radius: 2px; margin: 10px 15px; padding: 0 15px; line-height: 22px; font-size: 12px; color: #f60;}
	.award_mask{position: fixed; z-index: 100; left:50%; top: 50%;transform: translate(-50%,-50%);-webkit-transform: translate(-50%,-50%); border-radius: 4px; background: #fff; padding: 40px 30px 20px; width: 240px;}
	.award_mask .close{position: absolute; top: 15px; right: 15px;}
	.award_mask h3{font-size: 16px; font-weight: 500; line-height: 20px; text-align: center; margin-bottom: 20px;}
	.award_mask .int{border: 1px solid #999; border-radius: 2px; height: 40px; position: relative; padding-left: 40px; margin-bottom: 15px;}
	.award_mask .int:before{content: '￥'; font-size: 16px; color: #666; line-height: 40px; width: 40px; text-align: center; position: absolute; left: 0; top: 0;}
	.award_mask .int input{width: 100%; border: 0; height: 40px; background: none; outline: 0; font-size: 14px;}
	.award_mask .btn{width: 100%; border: 0; height: 40px; background: #20AD20;border-radius: 2px; outline: 0; font-size: 14px; color: #fff; line-height: 40px; text-align: center; display: block;}
	.award_mask_bg{position: fixed; z-index: 98; left: 0; top: 0; width: 100%; height: 100%; background:#000; opacity:0.6;}
</style>
<div class="container" id="container">
    <div class="page js_show">
        <div class="page_cont">
            <div class="container_mid">
            	<!--内容-开始-->
            		<div class="staffInfo">
            			<div class="info">
							<{if $data.staff.face}>
							<img src="<{$pager.img}>/<{$data.staff.face}>" width="90" height="90" class="img">
							<{else}>
							<img src="/themes/waimai/static/img/icon8@3x.png" width="90" height="90" class="img">
							<{/if}>

            				<h3><{$data.staff.name}></h3>
            			</div>
            			<img src="/themes/waimai/static/img/staffInfo_bg.png" width="100%" class="bg">
            			<div class="info_list mb10">
							<ul>
								<li>
									<p>总计送餐</p>
									<p class="num"><{$data.all_order}><small>份</small></p>
								</li>
								<li>
									<p>平均评分</p>
									<p class="num"><{$data.score}><small>分</small></p>
								</li>
								<li>
									<p>日均送餐</p>
									<p class="num"><{$data.avg_order}><small>份</small></p>
								</li>
							</ul>
            			</div>
            			<div class="info_list infoTwo_list mb10">
            				<ul>
            					<li>
									<p>日均奔波</p>
									<p class="num"><{$data.avg_distance}><small>公里</small></p>
            					</li>
            					<li>
									<p>今日奔波</p>
									<p class="num"><{$data.today_distance|default:"0"}><small>公里</small></p>
            					</li>
            					<li>
									<p>累计奔波</p>
									<p class="num"><{$data.all_diatance}><small>公里</small></p>
            					</li>
            				</ul>
            			</div>
            			<div class="award mb10">
							<h2 class="tit">打赏骑手<small>(此费用将全部转交给骑手)</small></h2>
							<ul id="my_dashang">
								<li rel="1">
									<img src="/themes/waimai/static/img/bag.png" width="28" height="40">
									<p>¥1.00</p>
								</li>
								<li rel="2">
									<img src="/themes/waimai/static/img/bag.png" width="28" height="40">
									<p>¥2.00</p>
								</li>
								<li rel="5">
									<img src="/themes/waimai/static/img/bag.png" width="28" height="40">
									<p>¥5.00</p>
								</li>
								<li rel="-1">
									<img src="/themes/waimai/static/img/bag.png" width="28" height="40">
									<p>其它</p>
								</li>
							</ul>
							<div class="pub_list" onclick="tiao('<{$data.staff.staff_id}>','<{$order_id}>');">
								<div class="pub_list_bd">已有<{$data.count_reward}>份打赏</div>
								<!--<img src="" width="12" height="12" class="img">-->
								<img src="/themes/waimai/static/img/icon-arrowR-gray@2x.png" width="8">
							</div>
            			</div>
            			<div class="score mb10">
            				<h2 class="tit">骑手评分</h2>

            				<div>
								<{foreach $comment as $k=>$v}>
								<a href=""><{$k}>分(<{$v}>)</a>

								<{/foreach}>
            				</div>
            			</div>
            		</div>
            	<!--内容-结束-->
            </div>
        </div>
    </div>
</div>

<!--打赏弹层-开始-->
<div class="award_mask" style="display: none">
	<a href="javascript:;" class="close"><img src="/themes/waimai/static/img/index_btn_close@2x.png" width="14" height="14"></a>
	<div class="cont">
		<h3>感谢您的一份心意</h3>
		<div class="int"><input type="text" name="" placeholder="请输入打赏金额" id="input_money"></div>
		<a href="javascript:;" class="btn" id="reward">确定打赏</a>
	</div>
</div>
<div class="award_mask_bg" style="display: none;"></div>

<script type="text/javascript">
	$(".award_mask .close,.award_mask_bg").click(function(){
		$(".award_mask,.award_mask_bg").hide();
	});
	$('#my_dashang li').on('click',function(){
	   var rel  = parseInt($(this).attr('rel'));
	   if(rel>0){
	       $('#input_money').val(rel);
	   }else{
           $('#input_money').val('');
	   }

        $(".award_mask,.award_mask_bg").show();

	})
	$('#reward').on('click',function(){
	     var amount = $('#input_money').val();
	   if(!amount){
	      Widget.MsgBox.success('请输入打赏金额');
	      return false;
	   }
	   var data = {
	       "money":amount,
		   'staff_id':"<{$data.staff.staff_id}>"
	   };

	   var url = "<{link ctl='staff/ordercreate' http='waimai'}>";
	   $.post(url,{data:data},function(e){
	       if(e.error==0){
	           var order_id = parseInt('<{$order_id}>');
               var back_url = "<{link ctl='staff/detail' arg0=__STAFF_ID__ http='waimai' order_id='ORDER_ID'}>";
               var backurl = back_url.replace('__STAFF_ID__', "<{$data.staff.staff_id}>").replace('ORDER_ID',order_id);
	           var in_app_client = '<{$in_app_client}>';
               if(in_app_client){
                   if(in_app_client=="IOS"){
                       window.JHAPP.onPayment({
                           "order_id" : e.data.order_id,//订单ID
                           "amount" : e.data.amount, //订单金额
                           "rebackurl" : backurl, //支付后跳转的页面
                           "code" : "", //支付类型（可选），如果传了支付类型了就直接去支付了，如果没有传到选择支付方式的界面
                       });
				   }else {
                       window.JHAPP.onPayment(JSON.stringify({
                           "order_id" : e.data.order_id,
                           "amount" : e.data.amount,
                           "rebackurl" : backurl,
                           "code" : "",
                       }));
				   }
			   }else{

                   var pay_url = "<{link ctl='trade/payment:order' arg0=__order_id__ rebackurl=__back_url__ http='www'}>";
                   var payurl = pay_url.replace('__order_id__', e.data.order_id).replace('__back_url__', backurl);
                   window.location.href = payurl;
			   }
		   }else{
               Widget.MsgBox.success(e.message);
		   }
	   },'json');
	})

	function tiao(staff_id) {
		/*var url = "<{link ctl='staff/reward' arg0='#staff_id#' http='waimai' order_id='ORDER_ID'}>"
		window.location.href =url .replace('#staff_id#',staff_id).replace('ORDER_ID','<{$order_id}>');*/
		var in_app_client = '<{$in_app_client}>';
		var order_id = '<{$order_id}>';
		if(order_id > 0){
            var url = "<{link ctl='staff/reward' arg0='#staff_id#' http='waimai' order_id='ORDER_ID' in_app_client='IN_APP_CLIENT'}>";
			window.location.href =url .replace('#staff_id#',staff_id).replace('ORDER_ID',order_id).replace('IN_APP_CLIENT',in_app_client);
        }else{
            var url = "<{link ctl='staff/reward' arg0='#staff_id#' http='waimai' in_app_client='IN_APP_CLIENT'}>";
			window.location.href =url .replace('#staff_id#',staff_id).replace('IN_APP_CLIENT',in_app_client);
        }	    
    }

    $(document).ready(function(e) {
        /* var counter = 0;*/
        var in_app_client = '<{$in_app_client}>';
        if(!in_app_client){
            if (window.history && window.history.pushState) {
                $(window).on('popstate', function () {
                    window.history.pushState('forward', null, '#');
                    window.history.forward(1);
                    var order_id = parseInt('<{$order_id}>');
                    if(order_id>0){
                        var url = '<{link ctl="ucenter/order:detail" http="waimai" arg0="ORDER_ID"}>';
                        window.location.href = url.replace('ORDER_ID',order_id);
                    }else{
                        var url = '<{link ctl="ucenter/order:index" http="waimai"}>';
                        window.location.href = url;
                    }
                });
            }
            window.history.pushState('forward', null, '#'); //在IE中必须得有这两行
            window.history.forward(1);
		}else{
            /*if (window.history && window.history.pushState) {
                $(window).on('popstate', function () {
                    window.history.pushState('forward', null, '#');
                    window.history.forward(1);

                });
            }
            window.history.pushState('forward', null, '#'); //在IE中必须得有这两行
            window.history.forward(1);*/
        }
    });

</script>
<!--打赏弹层-结束-->
<{include file="waimai/block/footer.html"}>